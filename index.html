<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Trading Simulator Pro</title>

<style>
:root{
  --bg:#0e1225;--card:#1b2040;--blue:#4da3ff;
  --green:#3cff7a;--red:#ff4c4c;--text:#e6e6ff;
}
*{box-sizing:border-box;font-family:Arial}
body{margin:0;background:var(--bg);color:var(--text)}
main{display:flex;height:100vh}

/* ===== LEFT BAR ===== */
#left{
  width:30%;
  padding:10px;
  overflow-y:auto;
  background:#0b0f22;
}
.company{
  background:var(--card);
  border-radius:10px;
  padding:8px;
  margin-bottom:8px;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:4px;
}
.company button{
  border:none;border-radius:6px;
  padding:6px;cursor:pointer;
}
.buy{background:#2a8f5a}
.sell{background:#8f2a2a}

/* ===== RIGHT ===== */
#right{width:70%;padding:10px}
.tabs button{
  margin-right:8px;
  padding:8px 16px;
  border:none;border-radius:8px;
  cursor:pointer;background:var(--card);
}
.tabs button.active{background:var(--blue)}

canvas{width:100%;height:300px;background:#050713;border-radius:12px}

/* ===== STATS ===== */
table{width:100%;border-collapse:collapse}
th,td{padding:6px;text-align:right}
th{text-align:left}

/* ===== COLORS ===== */
.green{color:var(--green)}
.red{color:var(--red)}
.card{background:var(--card);padding:10px;border-radius:12px;margin-top:10px}
</style>
</head>

<body>
<main>
  <div id="left"></div>
  <div id="right"></div>
</main>

<script>
/* ===== DATA ===== */
let cash = 2000;
let selected = 0;

const companies = JSON.parse(localStorage.getItem("companies")) || [
{name:"AlphaTech",price:120,vol:0.6,shares:0,avg:0,history:[],buys:[],realized:0},
{name:"BioHealth",price:80,vol:0.5,shares:0,avg:0,history:[],buys:[],realized:0},
{name:"GreenEnergy",price:60,vol:0.4,shares:0,avg:0,history:[],buys:[],realized:0},
{name:"FinCorp",price:150,vol:0.7,shares:0,avg:0,history:[],buys:[],realized:0},
{name:"AeroSpace",price:200,vol:0.9,shares:0,avg:0,history:[],buys:[],realized:0},
{name:"RetailX",price:40,vol:0.6,shares:0,avg:0,history:[],buys:[],realized:0},
{name:"Foodies",price:30,vol:0.3,shares:0,avg:0,history:[],buys:[],realized:0},
{name:"NetCom",price:90,vol:0.8,shares:0,avg:0,history:[],buys:[],realized:0},
{name:"AutoDrive",price:110,vol:1,shares:0,avg:0,history:[],buys:[],realized:0},
{name:"CryptoX",price:50,vol:4,shares:0,avg:0,history:[],buys:[],realized:0}
];

cash = JSON.parse(localStorage.getItem("cash")) ?? cash;

/* ===== LEFT BAR ===== */
function renderLeft(){
  left.innerHTML = `<div class="card">üí∞ Cash : ${cash.toFixed(2)} ‚Ç¨</div>`;
  companies.forEach((c,i)=>{
    const gain=(c.price-c.avg)*c.shares;
    left.innerHTML+=`
    <div class="company">
      <strong>${c.name}</strong><span>${c.price.toFixed(2)}‚Ç¨</span>
      <span>Parts: ${c.shares}</span>
      <span class="${gain>=0?"green":"red"}">${gain.toFixed(2)}‚Ç¨</span>
      <button class="buy" onclick="buy(${i})">Acheter</button>
      <button class="sell" onclick="sell(${i})">Vendre</button>
    </div>`;
  });
}

/* ===== RIGHT ===== */
function renderRight(tab="graph"){
  right.innerHTML=`
  <div class="tabs">
    <button onclick="renderRight('graph')" class="${tab==='graph'?'active':''}">Graphique</button>
    <button onclick="renderRight('stats')" class="${tab==='stats'?'active':''}">Stats</button>
    <button onclick="renderRight('ia')" class="${tab==='ia'?'active':''}">IA</button>
  </div>`;

  if(tab==="graph") renderGraph();
  if(tab==="stats") renderStats();
  if(tab==="ia") renderIA();
}

/* ===== GRAPH ===== */
function renderGraph(){
  right.innerHTML+=`<canvas id="chart"></canvas><div class="card" id="details"></div>`;
  const c=companies[selected];
  const canvas=document.getElementById("chart");
  const ctx=canvas.getContext("2d");
  canvas.width=canvas.offsetWidth;
  canvas.height=300;

  const data=c.history.slice(-60);
  if(data.length<2) return;

  let min=Math.min(...data),max=Math.max(...data);
  const pad=(max-min)*0.2||1;min-=pad;max+=pad;

  const y=v=>(1-(Math.min(max,Math.max(min,v))-min)/(max-min))*canvas.height;

  ctx.beginPath();
  data.forEach((p,i)=>{
    const x=i/(data.length-1)*canvas.width;
    i?ctx.lineTo(x,y(p)):ctx.moveTo(x,y(p));
  });
  ctx.strokeStyle="#4da3ff";ctx.stroke();

  ctx.strokeStyle="#888";
  ctx.beginPath();
  ctx.moveTo(0,y(c.price));ctx.lineTo(canvas.width,y(c.price));
  ctx.stroke();

  document.getElementById("details").innerHTML=`
  Prix: ${c.price.toFixed(2)}‚Ç¨<br>
  Moyenne: ${c.avg.toFixed(2)}‚Ç¨<br>
  Parts: ${c.shares}<br>
  Gain latent: <span class="${(c.price-c.avg)*c.shares>=0?"green":"red"}">
  ${((c.price-c.avg)*c.shares).toFixed(2)}‚Ç¨</span>`;
}

/* ===== STATS ===== */
function renderStats(){
  let html=`<table>
  <tr><th>Entreprise</th><th>Parts</th><th>R√©alis√©</th><th>Latent</th><th>Total</th></tr>`;
  companies.forEach(c=>{
    const latent=(c.price-c.avg)*c.shares;
    html+=`<tr>
    <td>${c.name}</td>
    <td>${c.shares}</td>
    <td>${c.realized.toFixed(2)}</td>
    <td>${latent.toFixed(2)}</td>
    <td>${(latent+c.realized).toFixed(2)}</td>
    </tr>`;
  });
  right.innerHTML+=html+"</table>";
}

/* ===== IA ===== */
function renderIA(){
  let html=`<div class="card"><h3>ü§ñ Recommandations IA</h3>`;
  companies.forEach(c=>{
    if(c.history.length<20) return;
    const recent=c.history.slice(-20);
    const trend=(recent[19]-recent[0])/recent[0];
    const score=(trend*100)/(c.vol);
    const prob=Math.min(95,Math.max(5,50+score));

    if(score>5){
      html+=`‚úÖ <b>${c.name}</b> ‚Üí ACHETER (${prob.toFixed(1)}%)<br>`;
    }
    if(score<-5 && c.shares>0){
      html+=`‚ùå <b>${c.name}</b> ‚Üí VENDRE (${(100-prob).toFixed(1)}%)<br>`;
    }
  });
  right.innerHTML+=html+"</div>";
}

/* ===== BUY / SELL ===== */
function buy(i){
  const c=companies[i];
  if(cash>=c.price){
    cash-=c.price;
    c.avg=(c.avg*c.shares+c.price)/(c.shares+1);
    c.shares++;c.buys.push(c.history.length);
    save();
  }
}
function sell(i){
  const c=companies[i];
  if(c.shares>0){
    cash+=c.price;
    c.realized+=c.price-c.avg;
    c.shares--;if(!c.shares)c.avg=0;
    save();
  }
}

/* ===== MARKET ===== */
setInterval(()=>{
  companies.forEach(c=>{
    c.price=Math.max(0.1,c.price*(1+(Math.random()-0.5)*c.vol/50));
    c.history.push(c.price);
    if(c.history.length>300)c.history.shift();
  });
  renderLeft();renderRight();
},300);

/* ===== SAVE ===== */
function save(){
  localStorage.setItem("cash",cash);
  localStorage.setItem("companies",JSON.stringify(companies));
}

renderLeft();renderRight();
</script>
</body>
</html>
