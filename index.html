<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Simulateur de Trading + IA Avancée</title>
<style>
:root{
  --bg:#0f1420;--panel:#161d2e;--card:#1c2540;
  --text:#e6e9f0;--muted:#8b93a7;
  --green:#2ecc71;--red:#e74c3c;--blue:#3498db;
}
*{box-sizing:border-box;font-family:Inter,Arial,sans-serif}
body{margin:0;background:var(--bg);color:var(--text);display:flex;height:100vh;overflow:hidden}
.sidebar{width:360px;background:var(--panel);display:flex;flex-direction:column}
.header{position:sticky;top:0;background:var(--panel);padding:12px;border-bottom:1px solid #222;z-index:2}
.header .row{display:flex;justify-content:space-between;margin:4px 0}
.green{color:var(--green)} .red{color:var(--red)}
.search{padding:10px;border-bottom:1px solid #222}
.search input{width:100%;padding:8px;border-radius:8px;border:none;background:#0b1020;color:#fff}
.list{overflow:auto;flex:1}
.company{padding:10px;border-bottom:1px solid #222;cursor:pointer}
.company.active{background:var(--card)}
.company .top{display:flex;justify-content:space-between}
.company .bottom{display:flex;justify-content:space-between;align-items:center;margin-top:6px}
.btns button{background:#222c4d;border:none;color:#fff;padding:4px 10px;border-radius:6px;cursor:pointer;transition:.2s}
.btns button:hover{transform:scale(1.05)}
.btns button.buy{background:var(--green)}
.btns button.sell{background:var(--red)}
.main{flex:1;display:flex;flex-direction:column}
.tabs{display:flex;background:var(--panel)}
.tabs button{flex:1;padding:10px;border:none;background:none;color:var(--muted);cursor:pointer}
.tabs button.active{color:#fff;border-bottom:2px solid var(--blue)}
.view{flex:1;display:none;overflow:hidden}
.view.active{display:flex}
.chartWrap{flex:1;display:flex;flex-direction:column;padding:10px}
canvas{background:#0b1020;border-radius:12px;max-width:100%;max-height:100%}
.details{display:flex;justify-content:space-around;margin-top:8px}
.stats,.ai{padding:14px;overflow:auto;width:100%}
.ai-card{background:var(--card);padding:14px;border-radius:12px;margin-bottom:12px}
.ai button{margin-top:10px;padding:10px;width:100%;border:none;border-radius:10px;background:var(--green);color:#000;font-weight:bold;cursor:pointer}
.ai small{color:var(--muted)}
</style>
</head>
<body>

<div class="sidebar">
  <div class="header">
    <div class="row"><span>Capital</span><span id="capital"></span></div>
    <div class="row"><span>Portefeuille</span><span id="portfolio"></span></div>
    <div class="row"><span>Gain global</span><span id="globalGain"></span></div>
  </div>
  <div class="search">
    <input id="search" placeholder="Rechercher une entreprise">
  </div>
  <div class="list" id="companyList"></div>
</div>

<div class="main">
  <div class="tabs">
    <button class="active" data-tab="trade">Trading</button>
    <button data-tab="stats">Stats</button>
    <button data-tab="ai">IA</button>
  </div>

  <div class="view active" id="trade">
    <div class="chartWrap">
      <canvas id="chart" width="800" height="400"></canvas>
      <div class="details" id="details"></div>
    </div>
  </div>

  <div class="view" id="stats">
    <div class="stats">
      <table>
        <thead>
          <tr><th>Entreprise</th><th>Réalisé</th><th>Latent</th><th>Total</th></tr>
        </thead>
        <tbody id="statsBody"></tbody>
      </table>
    </div>
  </div>

  <div class="view" id="ai">
    <div class="ai">
      <div class="ai-card" id="aiMain"></div>
      <div class="ai-card" id="aiData"></div>
      <div class="ai-card" id="aiList"></div>
    </div>
  </div>
</div>

<script>
(()=>{
const NAMES=[ "TechNova","DataSphere","QuantumSys","CyberLink","AIWorks","NextGen","FutureLabs","DigitalCore","SmartLogic","VisionTech","EcoPower","Solaris","WindForce","HydroFlow","BioEarth","HealthTech","MediCore","LifeSystems","CarePlus","NeuroLab","AutoMotion","DriveX","ElectroCar","RoadTech","Motorix","ShopEase","MarketHub","BuySmart","RetailPro","EcomPlus","FinTrust","MoneyFlow","CreditWay","PaySmart","WealthX","GameForge","PlayVerse","PixelWorks","VRStudio","E-Sportix","LogiTrans","ShipFast","CargoNet","MoveX","SupplyPro" ];

let state=JSON.parse(localStorage.getItem("tradingState"))||{
  capital:2000,
  companies:NAMES.map(n=>({name:n,price:50+Math.random()*100,vol:0.5+Math.random()*1.5,shares:0,avg:0,history:[],buys:[],realized:0}))
};

let selected=0,search="",bestIndex=0;
const MAX_POINTS=60;
const $=id=>document.getElementById(id);
const fmt=v=>v.toFixed(2)+" €";
const save=()=>localStorage.setItem("tradingState",JSON.stringify(state));

function updatePrices(){
  state.companies.forEach(c=>{
    let d=(Math.random()-0.5)*c.vol;
    c.price=Math.max(0.1,c.price+d);
    c.history.push(c.price);
    if(c.history.length>MAX_POINTS)c.history.shift();
  });
  render();save();
}

function buy(i){
  let c=state.companies[i];
  if(state.capital>=c.price){
    state.capital-=c.price;
    c.avg=(c.avg*c.shares+c.price)/(c.shares+1);
    c.shares++;
    c.buys.push({price:c.price,index:c.history.length-1});
  }
}
function sell(i){
  let c=state.companies[i];
  if(c.shares>0){
    state.capital+=c.price;
    c.realized+=(c.price-c.avg);
    c.shares--; if(!c.shares)c.avg=0;
  }
}

function indicators(c){
  if(c.history.length<10)return {momentum:0,volatility:0,trend:0,estimate:0,confidence:0};
  let last=c.history.slice(-5);
  let prev=c.history.slice(-10,-5);
  let ma1=last.reduce((a,b)=>a+b,0)/5;
  let ma2=prev.reduce((a,b)=>a+b,0)/5;
  let trend=(ma1-ma2)/ma2;
  let volatility=Math.sqrt(last.map(p=>Math.pow(p-ma1,2)).reduce((a,b)=>a+b,0)/5)/ma1;
  let momentum=(last[4]-last[0])/last[0];
  let estimate=trend*100*0.8;
  let confidence=Math.min(100,Math.max(5,(1-volatility)*100));
  return {momentum,volatility,trend,estimate,confidence};
}

function aiAnalysis(){
  let ranked=state.companies.map((c,i)=>{
    let ind=indicators(c);
    return {...c,index:i,score:ind.trend,ind};
  }).sort((a,b)=>b.score-a.score);

  let b=ranked[0]; bestIndex=b.index;

  $("aiMain").innerHTML=`
    <b>Suggestion principale IA</b><br><br>
    <strong>${b.name}</strong><br>
    Hausse estimée (court terme) :
    <span class="${b.ind.estimate>=0?'green':'red'}">
      ${b.ind.estimate.toFixed(2)} %
    </span>
    <button onclick="window.buyFromIA()">Acheter 1 part immédiatement</button>
    <small>Décision basée sur tendances, momentum et volatilité</small>
  `;

  $("aiData").innerHTML=`
    <b>Données analysées</b><br><br>
    Momentum : ${(b.ind.momentum*100).toFixed(2)} %<br>
    Volatilité : ${(b.ind.volatility*100).toFixed(2)} %<br>
    Force de tendance : ${(b.ind.trend*100).toFixed(2)} %<br>
    Confiance IA : ${b.ind.confidence.toFixed(0)} %
  `;

  $("aiList").innerHTML="<b>Classement prédictif</b><br><br>"+
    ranked.slice(0,10).map(c=>`
      ${c.name} :
      <span class="${c.score>=0?'green':'red'}">
        ${(c.score*100).toFixed(2)} %
      </span>
    `).join("<br>");
}

window.buyFromIA=()=>{buy(bestIndex);selected=bestIndex;render();};

function renderSidebar(){
  $("companyList").innerHTML="";
  [...state.companies].filter(c=>c.name.toLowerCase().includes(search))
    .sort((a,b)=>b.shares-a.shares).forEach(c=>{
      let i=state.companies.indexOf(c);
      let l=(c.price-c.avg)*c.shares;
      let d=document.createElement("div");
      d.className="company"+(i===selected?" active":"");
      d.onclick=()=>{selected=i;render()};
      d.innerHTML=`
        <div class="top"><span>${c.name}</span><span>${fmt(c.price)}</span></div>
        <div class="bottom">
          <span>${c.shares} parts</span>
          <span class="${l>=0?'green':'red'}">${fmt(l)}</span>
          <div class="btns">
            <button class="buy">+</button>
            <button class="sell">−</button>
          </div>
        </div>`;
      d.querySelector(".buy").onclick=e=>{e.stopPropagation();buy(i)};
      d.querySelector(".sell").onclick=e=>{e.stopPropagation();sell(i)};
      $("companyList").appendChild(d);
    });
}

function renderHeader(){
  let p=state.capital,r=0,l=0;
  state.companies.forEach(c=>{p+=c.price*c.shares;r+=c.realized;l+=(c.price-c.avg)*c.shares;});
  $("capital").textContent=fmt(state.capital);
  $("portfolio").textContent=fmt(p);
  $("globalGain").textContent=fmt(r+l);
  $("globalGain").className=r+l>=0?"green":"red";
}

function renderDetails(){
  let c=state.companies[selected],l=(c.price-c.avg)*c.shares;
  $("details").innerHTML=`<span>Prix ${fmt(c.price)}</span><span>Moyen ${fmt(c.avg)}</span><span>Parts ${c.shares}</span><span class="${l>=0?'green':'red'}">${fmt(l)}</span>`;
}

function renderChart(){
  const ctx=$("chart").getContext("2d"); ctx.clearRect(0,0,800,400);
  let c=state.companies[selected],h=c.history;if(h.length<2)return;
  let min=Math.min(...h),max=Math.max(...h),pad=(max-min)*0.1||1;min-=pad;max+=pad;
  let step=800/(MAX_POINTS-1);
  ctx.strokeStyle="#3498db";ctx.beginPath();
  h.forEach((p,i)=>{let x=i*step,y=400-(p-min)/(max-min)*400;i?ctx.lineTo(x,y):ctx.moveTo(x,y)});ctx.stroke();
  let cy=400-(c.price-min)/(max-min)*400;
  ctx.strokeStyle="#444";ctx.beginPath();ctx.moveTo(0,cy);ctx.lineTo(800,cy);ctx.stroke();
  ctx.fillStyle="#2ecc71";
  c.buys.forEach(b=>{if(b.index<h.length){let x=b.index*step,y=400-(b.price-min)/(max-min)*400;ctx.beginPath();ctx.arc(x,y,4,0,Math.PI*2);ctx.fill();}});
}

function renderStats(){
  $("statsBody").innerHTML=state.companies.map(c=>{
    let l=(c.price-c.avg)*c.shares,t=c.realized+l;
    return `<tr><td>${c.name}</td><td class="${c.realized>=0?'green':'red'}">${fmt(c.realized)}</td><td class="${l>=0?'green':'red'}">${fmt(l)}</td><td class="${t>=0?'green':'red'}">${fmt(t)}</td></tr>`;
  }).join("");
}

function render(){renderHeader();renderSidebar();renderDetails();renderChart();renderStats();aiAnalysis();}

$("search").oninput=e=>{search=e.target.value.toLowerCase();render()};
document.querySelectorAll(".tabs button").forEach(b=>b.onclick=()=>{document.querySelectorAll(".tabs button").forEach(x=>x.classList.remove("active"));document.querySelectorAll(".view").forEach(v=>v.classList.remove("active"));b.classList.add("active");$(b.dataset.tab).classList.add("active");});
setInterval(updatePrices,450);render();
})();
</script>
</body>
</html>
