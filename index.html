<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Simulateur de Trading</title>
<style>
:root{
  --bg:#0f1420;--panel:#161d2e;--card:#1c2540;
  --text:#e6e9f0;--muted:#8b93a7;
  --green:#2ecc71;--red:#e74c3c;--blue:#3498db;
}
*{box-sizing:border-box;font-family:Inter,Arial,sans-serif}
body{margin:0;background:var(--bg);color:var(--text);display:flex;height:100vh;overflow:hidden}
.sidebar{width:360px;background:var(--panel);display:flex;flex-direction:column}
.header{position:sticky;top:0;background:var(--panel);padding:12px;border-bottom:1px solid #222}
.header .row{display:flex;justify-content:space-between;margin:4px 0}
.green{color:var(--green)} .red{color:var(--red)}
.list{overflow:auto;flex:1}
.company{padding:10px;border-bottom:1px solid #222;cursor:pointer}
.company.active{background:var(--card)}
.company .top{display:flex;justify-content:space-between}
.company .bottom{display:flex;justify-content:space-between;align-items:center;margin-top:6px}
.btns button{
  background:#222c4d;border:none;color:#fff;
  padding:4px 10px;border-radius:6px;cursor:pointer;
  transition:.2s
}
.btns button:hover{transform:scale(1.05)}
.btns button.buy{background:var(--green)}
.btns button.sell{background:var(--red)}
.main{flex:1;display:flex;flex-direction:column}
.tabs{display:flex;background:var(--panel)}
.tabs button{flex:1;padding:10px;border:none;background:none;color:var(--muted);cursor:pointer}
.tabs button.active{color:#fff;border-bottom:2px solid var(--blue)}
.view{flex:1;display:none;overflow:hidden}
.view.active{display:flex}
.chartWrap{flex:1;display:flex;flex-direction:column;padding:10px}
canvas{background:#0b1020;border-radius:12px;max-width:100%;max-height:100%}
.details{display:flex;justify-content:space-around;margin-top:8px}
.stats{padding:10px;overflow:auto;width:100%}
table{width:100%;border-collapse:collapse}
th,td{padding:6px;border-bottom:1px solid #222;text-align:right}
th:first-child,td:first-child{text-align:left}
</style>
</head>
<body>
<div class="sidebar">
  <div class="header">
    <div class="row"><span>Capital</span><span id="capital"></span></div>
    <div class="row"><span>Portefeuille</span><span id="portfolio"></span></div>
    <div class="row"><span>Gain global</span><span id="globalGain"></span></div>
  </div>
  <div class="list" id="companyList"></div>
</div>

<div class="main">
  <div class="tabs">
    <button class="active" data-tab="trade">Trading</button>
    <button data-tab="stats">Stats</button>
  </div>

  <div class="view active" id="trade">
    <div class="chartWrap">
      <canvas id="chart" width="800" height="400"></canvas>
      <div class="details" id="details"></div>
    </div>
  </div>

  <div class="view" id="stats">
    <div class="stats">
      <table>
        <thead>
          <tr><th>Entreprise</th><th>Réalisé</th><th>Latent</th><th>Total</th></tr>
        </thead>
        <tbody id="statsBody"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
(()=>{

const NAMES=[
"TechNova","DataSphere","QuantumSys","CyberLink","AIWorks","NextGen",
"FutureLabs","DigitalCore","SmartLogic","VisionTech",
"EcoPower","Solaris","WindForce","HydroFlow","BioEarth",
"HealthTech","MediCore","LifeSystems","CarePlus","NeuroLab",
"AutoMotion","DriveX","ElectroCar","RoadTech","Motorix",
"ShopEase","MarketHub","BuySmart","RetailPro","EcomPlus",
"FinTrust","MoneyFlow","CreditWay","PaySmart","WealthX",
"GameForge","PlayVerse","PixelWorks","VRStudio","E-Sportix",
"LogiTrans","ShipFast","CargoNet","MoveX","SupplyPro"
];

let state=JSON.parse(localStorage.getItem("tradingState"))||{
  capital:2000,
  companies:NAMES.map(n=>({
    name:n,
    price:50+Math.random()*100,
    vol:0.5+Math.random()*1.5,
    shares:0,
    avg:0,
    history:[],
    buys:[],
    realized:0
  }))
};

let selected=0;
const MAX_POINTS=60;

const $=id=>document.getElementById(id);
const fmt=v=>v.toFixed(2)+" €";

function save(){localStorage.setItem("tradingState",JSON.stringify(state))}

function updatePrices(){
  state.companies.forEach(c=>{
    let delta=(Math.random()-0.5)*c.vol;
    c.price=Math.max(0.1,c.price+delta);
    c.history.push(c.price);
    if(c.history.length>MAX_POINTS)c.history.shift();
  });
  render();
  save();
}

function buy(i){
  let c=state.companies[i];
  if(state.capital>=c.price){
    state.capital-=c.price;
    c.avg=(c.avg*c.shares+c.price)/(c.shares+1);
    c.shares++;
    c.buys.push({price:c.price,index:c.history.length-1});
  }
}

function sell(i){
  let c=state.companies[i];
  if(c.shares>0){
    state.capital+=c.price;
    c.realized+=(c.price-c.avg);
    c.shares--;
    if(c.shares===0)c.avg=0;
  }
}

function renderSidebar(){
  $("companyList").innerHTML="";
  state.companies.forEach((c,i)=>{
    let latent=(c.price-c.avg)*c.shares;
    let div=document.createElement("div");
    div.className="company"+(i===selected?" active":"");
    div.onclick=()=>{selected=i;render()};
    div.innerHTML=`
      <div class="top">
        <span>${c.name}</span>
        <span>${fmt(c.price)}</span>
      </div>
      <div class="bottom">
        <span>${c.shares} parts</span>
        <span class="${latent>=0?"green":"red"}">${fmt(latent)}</span>
        <div class="btns">
          <button class="buy">+</button>
          <button class="sell">−</button>
        </div>
      </div>`;
    div.querySelector(".buy").onclick=e=>{e.stopPropagation();buy(i)};
    div.querySelector(".sell").onclick=e=>{e.stopPropagation();sell(i)};
    $("companyList").appendChild(div);
  });
}

function renderHeader(){
  let portfolio=state.capital;
  let realized=0,latent=0;
  state.companies.forEach(c=>{
    portfolio+=c.price*c.shares;
    realized+=c.realized;
    latent+=(c.price-c.avg)*c.shares;
  });
  $("capital").textContent=fmt(state.capital);
  $("portfolio").textContent=fmt(portfolio);
  let g=realized+latent;
  let el=$("globalGain");
  el.textContent=fmt(g);
  el.className=g>=0?"green":"red";
}

function renderDetails(){
  let c=state.companies[selected];
  let latent=(c.price-c.avg)*c.shares;
  $("details").innerHTML=`
    <span>Prix: ${fmt(c.price)}</span>
    <span>Moyen: ${fmt(c.avg)}</span>
    <span>Parts: ${c.shares}</span>
    <span class="${latent>=0?"green":"red"}">Latent: ${fmt(latent)}</span>`;
}

function renderChart(){
  const canvas=$("chart"),ctx=canvas.getContext("2d");
  ctx.clearRect(0,0,canvas.width,canvas.height);
  let c=state.companies[selected];
  let h=c.history;
  if(h.length<2)return;
  let min=Math.min(...h),max=Math.max(...h);
  let pad=(max-min)*0.1||1;
  min-=pad;max+=pad;
  const xStep=canvas.width/(MAX_POINTS-1);

  ctx.strokeStyle="var(--blue)";
  ctx.beginPath();
  h.forEach((p,i)=>{
    let x=i*xStep;
    let y=canvas.height-(p-min)/(max-min)*canvas.height;
    if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);
  });
  ctx.stroke();

  // current price line
  ctx.strokeStyle="#444";
  let cy=canvas.height-(c.price-min)/(max-min)*canvas.height;
  ctx.beginPath();ctx.moveTo(0,cy);ctx.lineTo(canvas.width,cy);ctx.stroke();

  // buy points
  ctx.fillStyle="var(--green)";
  c.buys.forEach(b=>{
    if(b.index>=0 && b.index<h.length){
      let x=b.index*xStep;
      let y=canvas.height-(b.price-min)/(max-min)*canvas.height;
      ctx.beginPath();ctx.arc(x,y,4,0,Math.PI*2);ctx.fill();
    }
  });
}

function renderStats(){
  let body=$("statsBody");body.innerHTML="";
  state.companies.forEach(c=>{
    let latent=(c.price-c.avg)*c.shares;
    let total=c.realized+latent;
    let tr=document.createElement("tr");
    tr.innerHTML=`
      <td>${c.name}</td>
      <td class="${c.realized>=0?"green":"red"}">${fmt(c.realized)}</td>
      <td class="${latent>=0?"green":"red"}">${fmt(latent)}</td>
      <td class="${total>=0?"green":"red"}">${fmt(total)}</td>`;
    body.appendChild(tr);
  });
}

function render(){
  renderHeader();
  renderSidebar();
  renderDetails();
  renderChart();
  renderStats();
}

document.querySelectorAll(".tabs button").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll(".tabs button").forEach(x=>x.classList.remove("active"));
    document.querySelectorAll(".view").forEach(v=>v.classList.remove("active"));
    b.classList.add("active");
    $(b.dataset.tab).classList.add("active");
  };
});

setInterval(updatePrices,450);
render();

})();
</script>
</body>
</html>
