<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Simulateur de Trading + IA</title>
<style>
:root{
  --bg:#0f1420;--panel:#161d2e;--card:#1c2540;
  --text:#e6e9f0;--muted:#8b93a7;
  --green:#2ecc71;--red:#e74c3c;--blue:#3498db;
}
*{box-sizing:border-box;font-family:Inter,Arial,sans-serif}
body{margin:0;background:var(--bg);color:var(--text);display:flex;height:100vh;overflow:hidden}
.sidebar{width:380px;background:var(--panel);display:flex;flex-direction:column}
.header{position:sticky;top:0;background:var(--panel);padding:12px;border-bottom:1px solid #222;z-index:5}
.header .row{display:flex;justify-content:space-between;margin:4px 0}
.green{color:var(--green)} .red{color:var(--red)}
.search{padding:10px;border-bottom:1px solid #222}
.search input{width:100%;padding:8px;border-radius:8px;border:none;background:#0f152a;color:#fff}
.list{overflow:auto;flex:1}
.company{padding:10px;border-bottom:1px solid #222;cursor:pointer}
.company.active{background:var(--card)}
.company .top{display:flex;justify-content:space-between}
.company .bottom{display:flex;justify-content:space-between;align-items:center;margin-top:6px}
.btns button{border:none;color:#fff;padding:4px 10px;border-radius:6px;cursor:pointer;transition:.15s}
.btns button.buy{background:var(--green)}
.btns button.sell{background:var(--red)}
.main{flex:1;display:flex;flex-direction:column}
.tabs{display:flex;background:var(--panel)}
.tabs button{flex:1;padding:10px;border:none;background:none;color:var(--muted);cursor:pointer}
.tabs button.active{color:#fff;border-bottom:2px solid var(--blue)}
.view{flex:1;display:none;overflow:hidden}
.view.active{display:flex}
.chartWrap{flex:1;display:flex;flex-direction:column;padding:10px}
canvas{background:#0b1020;border-radius:12px}
.details{display:flex;justify-content:space-around;margin-top:8px}
.stats,.ai{padding:14px;overflow:auto;width:100%}
.ai-card{background:var(--card);padding:14px;border-radius:12px;margin-bottom:14px}
.ai button{background:var(--green);border:none;color:#fff;padding:10px 14px;border-radius:10px;cursor:pointer;margin-top:10px}
</style>
</head>
<body>

<div class="sidebar">
  <div class="header">
    <div class="row"><span>Capital</span><span id="capital"></span></div>
    <div class="row"><span>Portefeuille</span><span id="portfolio"></span></div>
    <div class="row"><span>Gain global</span><span id="globalGain"></span></div>
  </div>
  <div class="search">
    <input id="search" placeholder="Rechercher une entreprise">
  </div>
  <div class="list" id="companyList"></div>
</div>

<div class="main">
  <div class="tabs">
    <button class="active" data-tab="trade">Trading</button>
    <button data-tab="stats">Stats</button>
    <button data-tab="ai">IA</button>
  </div>

  <div class="view active" id="trade">
    <div class="chartWrap">
      <canvas id="chart" width="800" height="400"></canvas>
      <div class="details" id="details"></div>
    </div>
  </div>

  <div class="view" id="stats">
    <div class="stats">
      <table>
        <thead>
          <tr><th>Entreprise</th><th>Réalisé</th><th>Latent</th><th>Total</th></tr>
        </thead>
        <tbody id="statsBody"></tbody>
      </table>
    </div>
  </div>

  <div class="view" id="ai">
    <div class="ai">
      <div class="ai-card" id="aiMain"></div>
      <div class="ai-card" id="aiList"></div>
    </div>
  </div>
</div>

<script>
(()=>{
const NAMES=[
"TechNova","DataSphere","QuantumSys","CyberLink","AIWorks","NextGen",
"FutureLabs","DigitalCore","SmartLogic","VisionTech",
"EcoPower","Solaris","WindForce","HydroFlow","BioEarth",
"HealthTech","MediCore","LifeSystems","CarePlus","NeuroLab",
"AutoMotion","DriveX","ElectroCar","RoadTech","Motorix",
"ShopEase","MarketHub","BuySmart","RetailPro","EcomPlus",
"FinTrust","MoneyFlow","CreditWay","PaySmart","WealthX",
"GameForge","PlayVerse","PixelWorks","VRStudio","E-Sportix",
"LogiTrans","ShipFast","CargoNet","MoveX","SupplyPro"
];

let state=JSON.parse(localStorage.getItem("tradingState"))||{
  capital:2000,
  companies:NAMES.map(n=>({name:n,price:50+Math.random()*100,vol:0.5+Math.random()*1.5,shares:0,avg:0,history:[],buys:[],realized:0}))
};

let selected=0, bestIndex=0;
const MAX=60;
const $=id=>document.getElementById(id);
const fmt=v=>v.toFixed(2)+" €";
const save=()=>localStorage.setItem("tradingState",JSON.stringify(state));

function buy(i){
  let c=state.companies[i];
  if(state.capital>=c.price){
    state.capital-=c.price;
    c.avg=(c.avg*c.shares+c.price)/(c.shares+1);
    c.shares++;
    c.buys.push({price:c.price,index:c.history.length-1});
  }
}

function updatePrices(){
  state.companies.forEach(c=>{
    c.price=Math.max(0.1,c.price+(Math.random()-0.5)*c.vol);
    c.history.push(c.price);
    if(c.history.length>MAX)c.history.shift();
  });
  render();save();
}

function trend(c){
  if(c.history.length<10)return 0;
  let a=c.history.slice(-5).reduce((x,y)=>x+y)/5;
  let b=c.history.slice(-10,-5).reduce((x,y)=>x+y)/5;
  return (a-b)/b;
}

function aiAnalysis(){
  let scores=state.companies.map((c,i)=>({i,score:trend(c)})).sort((a,b)=>b.score-a.score);
  bestIndex=scores[0].i;
  let best=state.companies[bestIndex];
  $("aiMain").innerHTML=`
    <b>Meilleure opportunité IA</b><br><br>
    ${best.name}<br>
    Tendance estimée : <span class="green">${(scores[0].score*100).toFixed(2)}%</span><br>
    Prix actuel : ${fmt(best.price)}<br>
    <button id="aiBuy">Acheter 1 part</button>
  `;
  $("aiBuy").onclick=()=>{buy(bestIndex);render()};
  $("aiList").innerHTML="<b>Classement prédictif</b><br><br>"+
    scores.slice(0,10).map(s=>{
      let c=state.companies[s.i];
      return `${c.name} :
      <span class="${s.score>=0?"green":"red"}">${(s.score*100).toFixed(2)}%</span>`;
    }).join("<br>");
}

function renderSidebar(){
  let q=$("search").value.toLowerCase();
  $("companyList").innerHTML="";
  [...state.companies].filter(c=>c.name.toLowerCase().includes(q))
    .sort((a,b)=>b.shares-a.shares)
    .forEach(c=>{
      let i=state.companies.indexOf(c);
      let l=(c.price-c.avg)*c.shares;
      let d=document.createElement("div");
      d.className="company"+(i===selected?" active":"");
      d.onclick=()=>{selected=i;render()};
      d.innerHTML=`
        <div class="top"><span>${c.name}</span><span>${fmt(c.price)}</span></div>
        <div class="bottom">
          <span>${c.shares} parts</span>
          <span class="${l>=0?"green":"red"}">${fmt(l)}</span>
          <div class="btns">
            <button class="buy">+</button>
            <button class="sell">−</button>
          </div>
        </div>`;
      d.querySelector(".buy").onclick=e=>{e.stopPropagation();buy(i)};
      d.querySelector(".sell").onclick=e=>{e.stopPropagation();if(c.shares){state.capital+=c.price;c.realized+=c.price-c.avg;c.shares--;if(!c.shares)c.avg=0}};
      $("companyList").appendChild(d);
    });
}

function renderHeader(){
  let p=state.capital,r=0,l=0;
  state.companies.forEach(c=>{p+=c.price*c.shares;r+=c.realized;l+=(c.price-c.avg)*c.shares});
  $("capital").textContent=fmt(state.capital);
  $("portfolio").textContent=fmt(p);
  $("globalGain").textContent=fmt(r+l);
  $("globalGain").className=r+l>=0?"green":"red";
}

function renderDetails(){
  let c=state.companies[selected];
  let l=(c.price-c.avg)*c.shares;
  $("details").innerHTML=`Prix ${fmt(c.price)} | Moyen ${fmt(c.avg)} | Parts ${c.shares} | <span class="${l>=0?"green":"red"}">${fmt(l)}</span>`;
}

function renderChart(){
  let ctx=$("chart").getContext("2d");
  ctx.clearRect(0,0,800,400);
  let c=state.companies[selected],h=c.history;
  if(h.length<2)return;
  let min=Math.min(...h),max=Math.max(...h),pad=(max-min)*0.1||1;
  min-=pad;max+=pad;
  let step=800/(MAX-1);
  ctx.strokeStyle="#3498db";ctx.beginPath();
  h.forEach((p,i)=>{let x=i*step,y=400-(p-min)/(max-min)*400;i?ctx.lineTo(x,y):ctx.moveTo(x,y)});
  ctx.stroke();
  ctx.strokeStyle="#444";
  let cy=400-(c.price-min)/(max-min)*400;
  ctx.beginPath();ctx.moveTo(0,cy);ctx.lineTo(800,cy);ctx.stroke();
  ctx.fillStyle="#2ecc71";
  c.buys.forEach(b=>{if(b.index<h.length){let x=b.index*step,y=400-(b.price-min)/(max-min)*400;ctx.beginPath();ctx.arc(x,y,4,0,Math.PI*2);ctx.fill()}});
}

function renderStats(){
  $("statsBody").innerHTML=state.companies.map(c=>{
    let l=(c.price-c.avg)*c.shares,t=c.realized+l;
    return `<tr><td>${c.name}</td>
      <td class="${c.realized>=0?"green":"red"}">${fmt(c.realized)}</td>
      <td class="${l>=0?"green":"red"}">${fmt(l)}</td>
      <td class="${t>=0?"green":"red"}">${fmt(t)}</td></tr>`;
  }).join("");
}

function render(){
  renderHeader();renderSidebar();renderDetails();renderChart();renderStats();aiAnalysis();
}

$("search").oninput=render;
document.querySelectorAll(".tabs button").forEach(b=>{
  b.onclick=()=>{
    document.querySelectorAll(".tabs button").forEach(x=>x.classList.remove("active"));
    document.querySelectorAll(".view").forEach(v=>v.classList.remove("active"));
    b.classList.add("active");$(b.dataset.tab).classList.add("active");
  };
});

setInterval(updatePrices,450);
render();
})();
</script>
</body>
</html>
