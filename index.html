<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Trading Simulator</title>

<style>
:root{
  --bg:#0b0f14;
  --panel:#121821;
  --panel2:#161d29;
  --border:#273040;
  --green:#2ea043;
  --red:#f85149;
  --blue:#58a6ff;
  --text:#e6e6e6;
}

body{
  margin:0;
  font-family:Segoe UI, Arial, sans-serif;
  background:var(--bg);
  color:var(--text);
}

header{
  padding:15px;
  text-align:center;
  font-size:22px;
  font-weight:bold;
  background:linear-gradient(90deg,#1f6feb,#238636);
}

nav{
  display:flex;
  background:var(--panel);
}

nav button{
  flex:1;
  padding:12px;
  background:none;
  border:none;
  color:white;
  cursor:pointer;
}

nav button.active{
  background:var(--panel2);
  border-bottom:3px solid var(--green);
}

.container{
  display:flex;
}

.left{
  width:42%;
  padding:15px;
  height:calc(100vh - 120px);
  overflow-y:auto;
}

.right{
  width:58%;
  padding:15px;
}

.card{
  background:var(--panel);
  padding:15px;
  margin-bottom:15px;
  border-radius:10px;
  border:1px solid var(--border);
}

.company{
  padding:12px;
  border-bottom:1px solid var(--border);
  cursor:pointer;
}

.company:hover{
  background:var(--panel2);
}

.company.active{
  background:#1f2937;
  border-left:4px solid var(--blue);
}

button.trade{
  padding:8px 14px;
  font-weight:600;
  border-radius:8px;
  border:none;
  cursor:pointer;
  transition:0.15s;
}

button.buy{background:#2ea043;color:white;}
button.sell{background:#f85149;color:white;}

.green{color:var(--green);}
.red{color:var(--red);}

canvas{
  background:#0b1220;
  border:1px solid var(--border);
  border-radius:8px;
}
</style>
</head>

<body>

<header>üìä Trading Simulator</header>

<nav>
  <button id="tabTrade" class="active" onclick="showTab('trade')">Trading</button>
  <button id="tabStats" onclick="showTab('stats')">Stats</button>
</nav>

<div class="container">

<div class="left">
<div id="tradeTab">
  <div class="card">
    üí∞ Capital : <b id="money"></b> ‚Ç¨<br>
    üìà Valeur totale : <b id="total"></b> ‚Ç¨<br>
    üßÆ Gain global : <b id="globalGain"></b> ‚Ç¨
  </div>
  <div class="card" id="companies"></div>
</div>

<div id="statsTab" style="display:none">
  <div class="card" id="stats"></div>
</div>
</div>

<div class="right">
  <div class="card">
    <h3 id="graphName"></h3>
    <canvas id="chart" width="760" height="360"></canvas>
    <div id="details"></div>
  </div>
</div>

</div>

<script>
let money = 2000;
let selected = 0;

const companies = [
 {name:"TechNova",price:120,vol:2},
 {name:"GreenFood",price:80,vol:1},
 {name:"HealthCorp",price:95,vol:1.3},
 {name:"AutoDrive",price:60,vol:2.4},
 {name:"CryptoX",price:50,vol:7},
 {name:"CloudNet",price:130,vol:1.8},
 {name:"GameForge",price:65,vol:3},
 {name:"RoboTech",price:140,vol:2.8},
 {name:"MediaWave",price:75,vol:1.6}
].map(c=>({...c,shares:0,avg:0,history:[],buys:[],realized:0}));

const ctx = document.getElementById("chart").getContext("2d");

function updateUI(){
  let total = money;
  let global = 0;
  companies.forEach(c=>{
    total += c.price * c.shares;
    global += c.realized + (c.price-c.avg)*c.shares;
  });

  money.textContent = money.toFixed(2);
  totalEl.textContent = total.toFixed(2);
  globalGain.textContent = global.toFixed(2);

  companiesEl.innerHTML="<h3>üè¢ Entreprises</h3>";
  companies.forEach((c,i)=>{
    const unreal = (c.price-c.avg)*c.shares;
    companiesEl.innerHTML+=`
    <div class="company ${i===selected?'active':''}" onclick="selectCompany(${i})">
      <b>${c.name}</b><br>
      ${c.price.toFixed(2)} ‚Ç¨ ‚Ä¢ Parts ${c.shares} ‚Ä¢
      <span class="${unreal>=0?'green':'red'}">${unreal.toFixed(2)} ‚Ç¨</span><br><br>
      <button class="trade buy" onclick="event.stopPropagation();buy(${i})">Acheter</button>
      <button class="trade sell" onclick="event.stopPropagation();sell(${i})">Vendre</button>
    </div>`;
  });
}

function buy(i){
  const c=companies[i];
  if(money>=c.price){
    money-=c.price;
    c.avg=(c.avg*c.shares+c.price)/(c.shares+1);
    c.shares++;
    c.buys.push(c.history.length);
  }
}

function sell(i){
  const c=companies[i];
  if(c.shares>0){
    money+=c.price;
    c.realized+=c.price-c.avg;
    c.shares--;
    if(c.shares===0)c.avg=0;
  }
}

function updatePrices(){
  companies.forEach(c=>{
    c.price=Math.max(1,c.price+(Math.random()*c.vol*4-c.vol*2));
    c.history.push(c.price);
    if(c.history.length>120){
      c.history.shift();
      c.buys=c.buys.map(b=>b-1).filter(b=>b>=0);
    }
  });
  drawGraph();
  updateUI();
}

function drawGraph(){
  const c=companies[selected];
  ctx.clearRect(0,0,760,360);
  if(c.history.length<2)return;

  const visible=c.history.slice(-60);
  let min=Math.min(...visible);
  let max=Math.max(...visible);
  let range=max-min||1;
  const pad=range*0.2;
  min-=pad; max+=pad; range=max-min;

  visible.forEach((p,i)=>{
    const x=i*(760/(visible.length-1));
    let y=340-((p-min)/range)*300;
    y=Math.max(20,Math.min(340,y));
    if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);
  });

  ctx.strokeStyle="#58a6ff";
  ctx.lineWidth=2;
  ctx.stroke();
}

function selectCompany(i){
  selected=i;
  graphName.textContent=companies[i].name;
  drawGraph();
}

function showTab(t){
  tradeTab.style.display=t==="trade"?"block":"none";
  statsTab.style.display=t==="stats"?"block":"none";
}

selectCompany(0);
updateUI();
setInterval(updatePrices,300);
</script>

</body>
</html>
