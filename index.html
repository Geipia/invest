<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Trading Simulator Pro</title>
<style>
:root{
  --bg:#0e1117;
  --panel:#161b22;
  --border:#222;
  --text:#e6edf3;
  --green:#2ecc71;
  --red:#e74c3c;
  --blue:#3498db;
}
*{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{margin:0;background:var(--bg);color:var(--text);overflow:hidden}
header{position:sticky;top:0;background:var(--panel);padding:10px;display:flex;gap:20px;border-bottom:1px solid var(--border);z-index:10}
.stat{flex:1}
.positive{color:var(--green)}
.negative{color:var(--red)}
main{display:flex;height:calc(100vh - 60px)}
#left{width:40%;display:flex;flex-direction:column;border-right:1px solid var(--border)}
#search{margin:10px;padding:8px;border-radius:6px;border:none;background:#0b0f14;color:var(--text)}
#companies{flex:1;overflow:auto}
.company{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-bottom:1px solid var(--border);cursor:pointer}
.company:hover{background:#0b0f14}
.buttons button{margin-left:5px;padding:4px 8px;border:none;border-radius:4px;cursor:pointer}
.buy{background:var(--green);color:#000}
.sell{background:var(--red);color:#000}
#right{flex:1;display:flex;flex-direction:column}
canvas{flex:1;background:#0b0f14}
#info,#ia,#stats{padding:10px;border-top:1px solid var(--border)}
.hidden{display:none}
table{width:100%;border-collapse:collapse}
td,th{padding:4px;border-bottom:1px solid var(--border);text-align:right}
td:first-child,th:first-child{text-align:left}
button.iaBuy{margin-top:8px;padding:6px 10px;border:none;border-radius:4px;background:var(--blue);color:#fff;cursor:pointer}
nav{display:flex;gap:10px;padding:6px;background:var(--panel)}
nav button{background:#0b0f14;border:none;color:var(--text);padding:6px 10px;border-radius:4px;cursor:pointer}
</style>
</head>
<body>
<header>
  <div class="stat">Capital: <span id="capital"></span></div>
  <div class="stat">Portefeuille: <span id="portfolio"></span></div>
  <div class="stat">Gain global: <span id="globalGain"></span></div>
</header>

<main>
  <div id="left">
    <input id="search" placeholder="Rechercher une entreprise">
    <div id="companies"></div>
  </div>
  <div id="right">
    <canvas id="chart"></canvas>
    <nav>
      <button data-tab="info">Trading</button>
      <button data-tab="stats">Stats</button>
      <button data-tab="ia">IA</button>
    </nav>
    <div id="info"></div>
    <div id="stats" class="hidden"></div>
    <div id="ia" class="hidden"></div>
  </div>
</main>

<script>
(()=>{

const NAMES=[
"TechNova","DataSphere","QuantumSys","CyberLink","AIWorks","NextGen","FutureLabs","DigitalCore","SmartLogic","VisionTech",
"EcoPower","Solaris","WindForce","HydroFlow","BioEarth",
"HealthTech","MediCore","LifeSystems","CarePlus","NeuroLab",
"AutoMotion","DriveX","ElectroCar","RoadTech","Motorix",
"ShopEase","MarketHub","BuySmart","RetailPro","EcomPlus",
"FinTrust","MoneyFlow","CreditWay","PaySmart","WealthX",
"GameForge","PlayVerse","PixelWorks","VRStudio","E-Sportix",
"LogiTrans","ShipFast","CargoNet","MoveX","SupplyPro"
];

let capital=2000;
let selected=null;
let companies={};

const saved=localStorage.getItem("simu");
if(saved){
  const d=JSON.parse(saved);
  capital=d.capital;
  companies=d.companies;
}else{
  NAMES.forEach(n=>{
    companies[n]={
      name:n,
      price:50+Math.random()*50,
      vol:0,
      shares:0,
      avg:0,
      history:[],
      buys:[],
      realized:0
    };
  });
}

const capEl=capitalEl=document.getElementById("capital");
const portEl=document.getElementById("portfolio");
const gainEl=document.getElementById("globalGain");
const listEl=document.getElementById("companies");
const infoEl=document.getElementById("info");
const statsEl=document.getElementById("stats");
const iaEl=document.getElementById("ia");
const searchEl=document.getElementById("search");
const canvas=document.getElementById("chart");
const ctx=canvas.getContext("2d");

function resize(){
  canvas.width=canvas.clientWidth;
  canvas.height=canvas.clientHeight;
}
window.addEventListener("resize",resize);
resize();

function save(){
  localStorage.setItem("simu",JSON.stringify({capital,companies}));
}

function updateHeader(){
  capEl.textContent=capital.toFixed(2)+" €";
  let port=capital;
  let realized=0,latent=0;
  Object.values(companies).forEach(c=>{
    port+=c.shares*c.price;
    realized+=c.realized;
    latent+=(c.price-c.avg)*c.shares;
  });
  portEl.textContent=port.toFixed(2)+" €";
  const g=realized+latent;
  gainEl.textContent=g.toFixed(2)+" €";
  gainEl.className=g>=0?"positive":"negative";
}

function buy(c){
  if(capital<c.price)return;
  capital-=c.price;
  c.avg=(c.avg*c.shares+c.price)/(c.shares+1);
  c.shares++;
  c.buys.push({price:c.price,index:c.history.length});
  save();
}

function sell(c){
  if(c.shares<=0)return;
  capital+=c.price;
  c.realized+=(c.price-c.avg);
  c.shares--;
  if(c.shares===0)c.avg=0;
  save();
}

function renderList(){
  const q=searchEl.value.toLowerCase();
  listEl.innerHTML="";
  Object.values(companies)
  .filter(c=>c.name.toLowerCase().includes(q))
  .sort((a,b)=>b.shares-a.shares)
  .forEach(c=>{
    const div=document.createElement("div");
    div.className="company";
    div.onclick=()=>selected=c;
    const latent=(c.price-c.avg)*c.shares;
    div.innerHTML=`
      <div>
        <strong>${c.name}</strong><br>
        ${c.price.toFixed(2)} €
      </div>
      <div>
        ${c.shares} parts<br>
        <span class="${latent>=0?"positive":"negative"}">${latent.toFixed(2)} €</span>
      </div>
      <div class="buttons">
        <button class="buy">+</button>
        <button class="sell">-</button>
      </div>`;
    div.querySelector(".buy").onclick=e=>{e.stopPropagation();buy(c)};
    div.querySelector(".sell").onclick=e=>{e.stopPropagation();sell(c)};
    listEl.appendChild(div);
  });
}

function tick(){
  Object.values(companies).forEach(c=>{
    const delta=(Math.random()-0.5)*0.5;
    c.price=Math.max(1,c.price+delta);
    c.history.push(c.price);
    if(c.history.length>200)c.history.shift();
  });
  updateHeader();
  renderList();
  renderChart();
  renderInfo();
  save();
}
setInterval(tick,450);

function renderChart(){
  if(!selected)return;
  const h=selected.history.slice(-60);
  ctx.clearRect(0,0,canvas.width,canvas.height);
  if(h.length<2)return;
  let min=Math.min(...h),max=Math.max(...h);
  const m=(max-min)*0.2;
  min-=m;max+=m;
  const scale=v=>(canvas.height-20)-(v-min)/(max-min)*(canvas.height-40);
  ctx.strokeStyle="var(--blue)";
  ctx.beginPath();
  h.forEach((v,i)=>{
    const x=i/(h.length-1)*canvas.width;
    const y=scale(v);
    if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y);
  });
  ctx.stroke();
  ctx.strokeStyle="#888";
  const y=scale(h[h.length-1]);
  ctx.beginPath();
  ctx.moveTo(0,y);ctx.lineTo(canvas.width,y);ctx.stroke();
  ctx.fillStyle="var(--green)";
  selected.buys.forEach(b=>{
    const idx=b.index-(selected.history.length-h.length);
    if(idx>=0&&idx<h.length){
      const x=idx/(h.length-1)*canvas.width;
      const yb=scale(b.price);
      ctx.beginPath();
      ctx.arc(x,yb,4,0,Math.PI*2);
      ctx.fill();
    }
  });
}

function renderInfo(){
  if(!selected){infoEl.textContent="";return}
  const latent=(selected.price-selected.avg)*selected.shares;
  infoEl.innerHTML=`
    <strong>${selected.name}</strong><br>
    Prix: ${selected.price.toFixed(2)} €<br>
    Prix moyen: ${selected.avg.toFixed(2)} €<br>
    Parts: ${selected.shares}<br>
    Gain latent: <span class="${latent>=0?"positive":"negative"}">${latent.toFixed(2)} €</span>
  `;
}

function renderStats(){
  const rows=Object.values(companies).map(c=>{
    const latent=(c.price-c.avg)*c.shares;
    const total=latent+c.realized;
    return {name:c.name,latent,realized:c.realized,total};
  }).sort((a,b)=>b.total-a.total);
  statsEl.innerHTML="<table><tr><th>Entreprise</th><th>Réalisé</th><th>Latent</th><th>Total</th></tr>"+
  rows.map(r=>`
    <tr>
      <td>${r.name}</td>
      <td>${r.realized.toFixed(2)}</td>
      <td>${r.latent.toFixed(2)}</td>
      <td class="${r.total>=0?"positive":"negative"}">${r.total.toFixed(2)}</td>
    </tr>`).join("")+"</table>";
}

function renderIA(){
  if(!selected){iaEl.textContent="";return}
  const h=selected.history.slice(-10);
  const slope=h.length>1?(h[h.length-1]-h[0])/h.length:0;
  const vol=Math.sqrt(h.reduce((s,v)=>s+(v-h[0])**2,0)/h.length);
  let action="ATTENDRE";
  if(slope>0.05)action="ACHETER";
  if(slope<-0.05)action="VENDRE";
  iaEl.innerHTML=`
    <strong>Analyse IA – ${selected.name}</strong><br>
    Suggestion: <strong>${action}</strong><br>
    Hausse estimée: ${(slope*10).toFixed(2)} %<br>
    Confiance: ${(Math.min(100,Math.abs(slope)*500)).toFixed(0)} %<br>
    Risque: ${(vol*10).toFixed(2)}<br>
    Tendance: ${slope>=0?"Haussière":"Baissière"}<br>
    Volatilité: ${vol.toFixed(2)}<br>
    Momentum: ${slope.toFixed(4)}<br>
    <button class="iaBuy">Acheter la suggestion</button>
  `;
  iaEl.querySelector(".iaBuy").onclick=()=>{if(action==="ACHETER")buy(selected)};
}

document.querySelectorAll("nav button").forEach(b=>{
  b.onclick=()=>{
    infoEl.classList.add("hidden");
    statsEl.classList.add("hidden");
    iaEl.classList.add("hidden");
    if(b.dataset.tab==="info")infoEl.classList.remove("hidden");
    if(b.dataset.tab==="stats"){statsEl.classList.remove("hidden");renderStats()}
    if(b.dataset.tab==="ia"){iaEl.classList.remove("hidden");renderIA()}
  };
});

searchEl.oninput=renderList;
renderList();
updateHeader();

})();
</script>
</body>
</html>
