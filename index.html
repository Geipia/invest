<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Simulateur de Trading</title>

<style>
:root{
    --bg:#0f172a;
    --card:#020617;
    --border:#1e293b;
    --text:#e5e7eb;
    --green:#22c55e;
    --red:#ef4444;
    --blue:#3b82f6;
}
*{box-sizing:border-box;font-family:Arial,Helvetica,sans-serif}
body{
    margin:0;
    background:var(--bg);
    color:var(--text);
}
header{
    padding:15px;
    display:flex;
    gap:10px;
}
.tab{
    padding:10px 20px;
    border-radius:10px;
    background:var(--card);
    cursor:pointer;
    transition:.2s;
}
.tab.active{
    background:var(--blue);
}
main{
    display:flex;
    height:calc(100vh - 60px);
}
#left{
    width:45%;
    padding:10px;
    overflow:auto;
}
#right{
    width:55%;
    padding:10px;
}
.card{
    background:var(--card);
    border:1px solid var(--border);
    border-radius:14px;
    padding:12px;
    margin-bottom:10px;
}
.row{
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin:4px 0;
}
.company{
    padding:10px;
    border-radius:12px;
    cursor:pointer;
}
.company:hover{
    background:#020617aa;
}
.btn{
    padding:6px 12px;
    border:none;
    border-radius:8px;
    cursor:pointer;
    font-weight:bold;
    transition:.15s;
}
.buy{background:var(--green);color:#052e16}
.sell{background:var(--red);color:#450a0a}
.btn:active{transform:scale(.92)}
.green{color:var(--green)}
.red{color:var(--red)}
canvas{
    width:100%;
    height:320px;
    background:#020617;
    border-radius:12px;
}
table{
    width:100%;
    border-collapse:collapse;
}
th,td{
    padding:6px;
    border-bottom:1px solid var(--border);
    text-align:right;
}
th{text-align:right}
th:first-child,td:first-child{text-align:left}
</style>
</head>

<body>

<header>
    <div class="tab active" onclick="switchTab('trading')">Trading</div>
    <div class="tab" onclick="switchTab('stats')">Stats</div>
</header>

<main>
    <div id="left">
        <div id="tradingTab">
            <div class="card">
                <div class="row"><span>Capital</span><b id="cash"></b></div>
                <div class="row"><span>Valeur totale</span><b id="total"></b></div>
                <div class="row"><span>Gain global</span><b id="global"></b></div>
            </div>
            <div id="companies"></div>
        </div>

        <div id="statsTab" style="display:none">
            <div class="card">
                <table id="statsTable"></table>
            </div>
        </div>
    </div>

    <div id="right">
        <div class="card">
            <canvas id="chart" width="600" height="320"></canvas>
        </div>
        <div class="card" id="details"></div>
    </div>
</main>

<script>
/* ====== DONNÉES ====== */
const BASE_COMPANIES = [
{name:"TechNova",price:65,vol:0.004},{name:"DataSphere",price:88,vol:0.005},
{name:"QuantumSys",price:110,vol:0.006},{name:"CyberLink",price:54,vol:0.004},
{name:"AIWorks",price:92,vol:0.005},{name:"NextGen",price:47,vol:0.003},
{name:"FutureLabs",price:73,vol:0.004},{name:"DigitalCore",price:59,vol:0.003},
{name:"SmartLogic",price:66,vol:0.004},{name:"VisionTech",price:81,vol:0.005},

{name:"EcoPower",price:44,vol:0.003},{name:"Solaris",price:50,vol:0.003},
{name:"WindForce",price:46,vol:0.003},{name:"HydroFlow",price:52,vol:0.002},
{name:"BioEarth",price:39,vol:0.002},

{name:"HealthTech",price:70,vol:0.003},{name:"MediCore",price:62,vol:0.002},
{name:"LifeSystems",price:75,vol:0.003},{name:"CarePlus",price:48,vol:0.002},
{name:"NeuroLab",price:85,vol:0.004},

{name:"AutoMotion",price:57,vol:0.004},{name:"DriveX",price:61,vol:0.004},
{name:"ElectroCar",price:90,vol:0.005},{name:"RoadTech",price:49,vol:0.003},
{name:"Motorix",price:53,vol:0.003},

{name:"ShopEase",price:29,vol:0.005},{name:"MarketHub",price:33,vol:0.004},
{name:"BuySmart",price:27,vol:0.004},{name:"RetailPro",price:35,vol:0.005},
{name:"EcomPlus",price:31,vol:0.006},

{name:"FinTrust",price:78,vol:0.003},{name:"MoneyFlow",price:69,vol:0.004},
{name:"CreditWay",price:64,vol:0.003},{name:"PaySmart",price:71,vol:0.004},
{name:"WealthX",price:95,vol:0.005},

{name:"GameForge",price:56,vol:0.006},{name:"PlayVerse",price:60,vol:0.007},
{name:"PixelWorks",price:52,vol:0.006},{name:"VRStudio",price:84,vol:0.008},
{name:"E-Sportix",price:68,vol:0.007},

{name:"LogiTrans",price:45,vol:0.003},{name:"ShipFast",price:51,vol:0.003},
{name:"CargoNet",price:58,vol:0.003},{name:"MoveX",price:43,vol:0.003},
{name:"SupplyPro",price:62,vol:0.004}
];

let cash = 2000;
let companies = [];
let selected = 0;
const windowSize = 60;

/* ====== INIT ====== */
function init(){
    const save = localStorage.getItem("tradingSave");
    if(save){
        ({cash,companies,selected} = JSON.parse(save));
    }else{
        companies = BASE_COMPANIES.map(c=>({
            ...c,
            shares:0,
            avg:0,
            realized:0,
            history:[c.price],
            buys:[]
        }));
    }
    render();
}
init();

/* ====== SIMULATION ====== */
setInterval(()=>{
    companies.forEach(c=>{
        const r = (Math.random()-0.5)*c.vol;
        c.price = Math.max(0.1,c.price*(1+r));
        c.history.push(c.price);
        if(c.history.length>300) c.history.shift();
    });
    save();
    render();
},450);

/* ====== ACTIONS ====== */
function buy(i){
    const c=companies[i];
    if(cash>=c.price){
        cash-=c.price;
        c.avg=(c.avg*c.shares+c.price)/(c.shares+1);
        c.shares++;
        c.buys.push({index:c.history.length-1,price:c.price});
    }
}
function sell(i){
    const c=companies[i];
    if(c.shares>0){
        cash+=c.price;
        c.realized+=(c.price-c.avg);
        c.shares--;
        if(c.shares===0) c.avg=0;
    }
}

/* ====== RENDER ====== */
function render(){
    renderHeader();
    renderCompanies();
    drawChart();
    renderDetails();
    renderStats();
}

function renderHeader(){
    const totalStocks=companies.reduce((s,c)=>s+c.shares*c.price,0);
    const realized=companies.reduce((s,c)=>s+c.realized,0);
    document.getElementById("cash").textContent=cash.toFixed(2)+" €";
    document.getElementById("total").textContent=(cash+totalStocks).toFixed(2)+" €";
    const g=realized+totalStocks-companies.reduce((s,c)=>s+c.shares*c.avg,0);
    document.getElementById("global").textContent=g.toFixed(2)+" €";
    document.getElementById("global").className=g>=0?"green":"red";
}

function renderCompanies(){
    const div=document.getElementById("companies");
    div.innerHTML="";
    companies.forEach((c,i)=>{
        const gain=(c.price-c.avg)*c.shares;
        const d=document.createElement("div");
        d.className="card company";
        d.onclick=()=>selected=i;
        d.innerHTML=`
        <div class="row">
            <b>${c.name}</b>
            <span>${c.price.toFixed(2)} €</span>
        </div>
        <div class="row">
            <span>Parts: ${c.shares}</span>
            <span class="${gain>=0?'green':'red'}">${gain.toFixed(2)} €</span>
        </div>
        <div class="row">
            <button class="btn buy" onclick="event.stopPropagation();buy(${i})">Acheter</button>
            <button class="btn sell" onclick="event.stopPropagation();sell(${i})">Vendre</button>
        </div>`;
        div.appendChild(d);
    });
}

/* ====== GRAPH ====== */
function drawChart(){
    const c=companies[selected];
    const ctx=document.getElementById("chart").getContext("2d");
    ctx.clearRect(0,0,600,320);

    const data=c.history.slice(-windowSize);
    const min=Math.min(...data);
    const max=Math.max(...data);
    const pad=(max-min)*0.15||1;

    ctx.strokeStyle="#3b82f6";
    ctx.beginPath();
    data.forEach((p,i)=>{
        const x=i/(windowSize-1)*600;
        const y=320-(p-(min-pad))/(max-min+pad*2)*320;
        i?ctx.lineTo(x,y):ctx.moveTo(x,y);
    });
    ctx.stroke();

    ctx.fillStyle="#22c55e";
    c.buys.forEach(b=>{
        const start=c.history.length-windowSize;
        if(b.index>=start){
            const i=b.index-start;
            const x=i/(windowSize-1)*600;
            const y=320-(b.price-(min-pad))/(max-min+pad*2)*320;
            ctx.beginPath();
            ctx.arc(x,y,4,0,Math.PI*2);
            ctx.fill();
        }
    });
}

/* ====== DETAILS ====== */
function renderDetails(){
    const c=companies[selected];
    const gain=(c.price-c.avg)*c.shares;
    document.getElementById("details").innerHTML=`
    <b>${c.name}</b><br>
    Prix actuel: ${c.price.toFixed(2)} €<br>
    Prix moyen: ${c.avg.toFixed(2)} €<br>
    Parts: ${c.shares}<br>
    Gain latent: <span class="${gain>=0?'green':'red'}">${gain.toFixed(2)} €</span>`;
}

/* ====== STATS ====== */
function renderStats(){
    const t=document.getElementById("statsTable");
    t.innerHTML="<tr><th>Entreprise</th><th>Réalisé</th><th>Latent</th><th>Total</th></tr>";
    companies.forEach(c=>{
        const latent=(c.price-c.avg)*c.shares;
        t.innerHTML+=`
        <tr>
            <td>${c.name}</td>
            <td>${c.realized.toFixed(2)}</td>
            <td>${latent.toFixed(2)}</td>
            <td>${(latent+c.realized).toFixed(2)}</td>
        </tr>`;
    });
}

/* ====== UTILS ====== */
function save(){
    localStorage.setItem("tradingSave",JSON.stringify({cash,companies,selected}));
}
function switchTab(t){
    document.getElementById("tradingTab").style.display=t==="trading"?"block":"none";
    document.getElementById("statsTab").style.display=t==="stats"?"block":"none";
    document.querySelectorAll(".tab").forEach(e=>e.classList.remove("active"));
    event.target.classList.add("active");
}
</script>
</body>
</html>
